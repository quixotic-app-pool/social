"use strict";

/**
 * @Author: MichaelChen <mymac>
 * @Date:   2018-01-30T10:02:42+08:00
 * @Email:  teacherincafe@163.com
 * @Project: one_server
 * @Filename: util.js
 * @Last modified by:   mymac
 * @Last modified time: 2018-02-11T20:40:42+08:00
 */
function age(birthDate) {
  var currentTime = new Date().toISOString();
  var customRegExp = /(\d{4})\-(\d{2})\-(\d{2})/;
  var date1 = customRegExp.exec(currentTime);
  var date2 = customRegExp.exec(birthDate);
  return date1[1] - date2[1] - (date1[2] < date1[2] ? 1 : 0);
}
function constellation(birthDate) {
  var month, date, value;
  var customRegExp = /(\d{4})\-(\d{2})\-(\d{2})/;
  var res = customRegExp.exec(birthDate);
  month = res[2];
  date = res[3];
  if (month == 1 && date >= 20 || month == 2 && date <= 18) {
    value = "水瓶座";
  }
  if (month == 1 && date > 31) {
    value = "huh?";
  }
  if (month == 2 && date >= 19 || month == 3 && date <= 20) {
    value = "双鱼座";
  }
  if (month == 2 && date > 29) {
    value = "say what?";
  }
  if (month == 3 && date >= 21 || month == 4 && date <= 19) {
    value = "白羊座";
  }
  if (month == 3 && date > 31) {
    value = "ok. whatever.";
  }
  if (month == 4 && date >= 20 || month == 5 && date <= 20) {
    value = "金牛座";
  }
  if (month == 4 && date > 30) {
    value = "i'm soooo sorry!";
  }
  if (month == 5 && date >= 21 || month == 6 && date <= 21) {
    value = "双子座";
  }
  if (month == 5 && date > 31) {
    value = "umm ... no.";
  }
  if (month == 6 && date >= 22 || month == 7 && date <= 22) {
    value = "巨蟹座";
  }
  if (month == 6 && date > 30) {
    value = "sorry.";
  }
  if (month == 7 && date >= 23 || month == 8 && date <= 22) {
    value = "狮子座";
  }
  if (month == 7 && date > 31) {
    value = "excuse me?";
  }
  if (month == 8 && date >= 23 || month == 9 && date <= 22) {
    value = "室女座";
  }
  if (month == 8 && date > 31) {
    value = "yeah. right.";
  }
  if (month == 9 && date >= 23 || month == 10 && date <= 22) {
    value = "天秤座";
  }
  if (month == 9 && date > 30) {
    value = "try again.";
  }
  if (month == 10 && date >= 23 || month == 11 && date <= 21) {
    value = "天蝎座";
  }
  if (month == 10 && date > 31) {
    value = "forget it!";
  }
  if (month == 11 && date >= 22 || month == 12 && date <= 21) {
    value = "人马座";
  }
  if (month == 11 && date > 30) {
    value = "invalid date";
  }
  if (month == 12 && date >= 22 || month == 1 && date <= 19) {
    value = "摩羯座";
  }
  if (month == 12 && date > 31) {
    value = "no way!";
  }
  // console.log('星座 value: ' + value);
  return value;
}
function getCurrentTime() {
  var keep = '';
  var date = new Date();
  var y = date.getFullYear();
  var m = date.getMonth() + 1;
  m = m < 10 ? '0' + m : m;
  var d = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();
  var h = date.getHours() < 10 ? '0' + date.getHours() : date.getHours();
  var f = date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes();
  var s = date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds();
  var rand = Math.round(Math.random() * 899 + 100);
  keep = y + '' + m + '' + d + '' + h + '' + f + '' + s;
  return keep; //20160614134947
}

function calLevel(p) {
  //points -> level mechanism
  if (p <= 2) {
    return 1;
  } else if (p <= 10) {
    return 2;
  } else if (p <= 20) {
    return 3;
  } else if (p <= 40) {
    return 4;
  } else if (p <= 80) {
    return 5;
  } else if (p <= 160) {
    return 6;
  } else if (p <= 320) {
    return 7;
  } else if (p <= 640) {
    return 8;
  } else if (p <= 1280) {
    return 9;
  } else {
    return 1;
  }
}

function calcTime(t, l) {
  var lang = l == 'EN';
  var str = '';
  if (t) {
    var createdAt = new Date(t);
    var now = new Date();
    var s = now - createdAt;
    if (s < 86400000 * 7) {
      var day = Math.floor(s / 86400000);
      var hour = Math.floor(s % 86400000 / 3600000);
      var minute = Math.floor(s % 86400000 % 3600000 / 60000);
      var seconds = Math.floor(s % 86400000 % 3600000 % 60000) / 1000;
      if (day > 0) {
        if (lang) {
          if (day > 1) {
            str = day + ' days ago';
          } else {
            str = day + ' day ago';
          }
        } else {
          str = day + "天前";
        }
        return str;
      }
      if (hour > 0) {
        if (lang) {
          if (hour > 1) {
            str = hour + ' hours ago';
          } else {
            str = hour + ' hour ago';
          }
        } else {
          str = hour + "小时前";
        }
        return str;
      }
      if (minute > 0) {
        if (lang) {
          if (minute > 1) {
            str = minute + ' minutes ago';
          } else {
            str = minute + ' minute ago';
          }
        } else {
          str = minute + "分钟前";
        }
        return str;
      }
      if (seconds < 60) {
        if (lang) {
          str = "just now";
        } else {
          str = "刚刚";
        }

        return str;
      }
    } else {
      return t.substring(0, 16);
    }
  } else {
    return str;
  }
}
module.exports = {
  getCurrentTime: getCurrentTime,
  calLevel: calLevel,
  calcTime: calcTime,
  age: age,
  constellation: constellation
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwuanMiXSwibmFtZXMiOlsiYWdlIiwiYmlydGhEYXRlIiwiY3VycmVudFRpbWUiLCJEYXRlIiwidG9JU09TdHJpbmciLCJjdXN0b21SZWdFeHAiLCJkYXRlMSIsImV4ZWMiLCJkYXRlMiIsImNvbnN0ZWxsYXRpb24iLCJtb250aCIsImRhdGUiLCJ2YWx1ZSIsInJlcyIsImdldEN1cnJlbnRUaW1lIiwia2VlcCIsInkiLCJnZXRGdWxsWWVhciIsIm0iLCJnZXRNb250aCIsImQiLCJnZXREYXRlIiwiaCIsImdldEhvdXJzIiwiZiIsImdldE1pbnV0ZXMiLCJzIiwiZ2V0U2Vjb25kcyIsInJhbmQiLCJNYXRoIiwicm91bmQiLCJyYW5kb20iLCJjYWxMZXZlbCIsInAiLCJjYWxjVGltZSIsInQiLCJsIiwibGFuZyIsInN0ciIsImNyZWF0ZWRBdCIsIm5vdyIsImRheSIsImZsb29yIiwiaG91ciIsIm1pbnV0ZSIsInNlY29uZHMiLCJzdWJzdHJpbmciLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7Ozs7QUFTRSxTQUFTQSxHQUFULENBQWNDLFNBQWQsRUFBeUI7QUFDdkIsTUFBSUMsY0FBYyxJQUFJQyxJQUFKLEdBQVdDLFdBQVgsRUFBbEI7QUFDQSxNQUFJQyxlQUFlLDJCQUFuQjtBQUNBLE1BQUlDLFFBQVFELGFBQWFFLElBQWIsQ0FBa0JMLFdBQWxCLENBQVo7QUFDQSxNQUFJTSxRQUFRSCxhQUFhRSxJQUFiLENBQWtCTixTQUFsQixDQUFaO0FBQ0EsU0FBUUssTUFBTSxDQUFOLElBQVdFLE1BQU0sQ0FBTixDQUFaLElBQXlCRixNQUFNLENBQU4sSUFBV0EsTUFBTSxDQUFOLENBQVgsR0FBc0IsQ0FBdEIsR0FBMEIsQ0FBbkQsQ0FBUDtBQUNEO0FBQ0QsU0FBU0csYUFBVCxDQUF1QlIsU0FBdkIsRUFBa0M7QUFDaEMsTUFBSVMsS0FBSixFQUFXQyxJQUFYLEVBQWlCQyxLQUFqQjtBQUNBLE1BQUlQLGVBQWUsMkJBQW5CO0FBQ0EsTUFBSVEsTUFBTVIsYUFBYUUsSUFBYixDQUFrQk4sU0FBbEIsQ0FBVjtBQUNBUyxVQUFRRyxJQUFJLENBQUosQ0FBUjtBQUNBRixTQUFPRSxJQUFJLENBQUosQ0FBUDtBQUNBLE1BQUlILFNBQVMsQ0FBVCxJQUFjQyxRQUFPLEVBQXJCLElBQTJCRCxTQUFTLENBQVQsSUFBY0MsUUFBTyxFQUFwRCxFQUF3RDtBQUFDQyxZQUFRLEtBQVI7QUFBZTtBQUN4RSxNQUFJRixTQUFTLENBQVQsSUFBY0MsT0FBTyxFQUF6QixFQUE2QjtBQUFDQyxZQUFRLE1BQVI7QUFBZ0I7QUFDOUMsTUFBSUYsU0FBUyxDQUFULElBQWNDLFFBQU8sRUFBckIsSUFBMkJELFNBQVMsQ0FBVCxJQUFjQyxRQUFPLEVBQXBELEVBQXdEO0FBQUNDLFlBQVEsS0FBUjtBQUFlO0FBQ3hFLE1BQUlGLFNBQVMsQ0FBVCxJQUFjQyxPQUFPLEVBQXpCLEVBQTZCO0FBQUNDLFlBQVEsV0FBUjtBQUFxQjtBQUNuRCxNQUFJRixTQUFTLENBQVQsSUFBY0MsUUFBTyxFQUFyQixJQUEyQkQsU0FBUyxDQUFULElBQWNDLFFBQU8sRUFBcEQsRUFBd0Q7QUFBQ0MsWUFBUSxLQUFSO0FBQWU7QUFDeEUsTUFBSUYsU0FBUyxDQUFULElBQWNDLE9BQU8sRUFBekIsRUFBNkI7QUFBQ0MsWUFBUSxlQUFSO0FBQXlCO0FBQ3ZELE1BQUlGLFNBQVMsQ0FBVCxJQUFjQyxRQUFPLEVBQXJCLElBQTJCRCxTQUFTLENBQVQsSUFBY0MsUUFBTyxFQUFwRCxFQUF3RDtBQUFDQyxZQUFRLEtBQVI7QUFBZTtBQUN4RSxNQUFJRixTQUFTLENBQVQsSUFBY0MsT0FBTyxFQUF6QixFQUE2QjtBQUFDQyxZQUFRLGtCQUFSO0FBQTRCO0FBQzFELE1BQUlGLFNBQVMsQ0FBVCxJQUFjQyxRQUFPLEVBQXJCLElBQTJCRCxTQUFTLENBQVQsSUFBY0MsUUFBTyxFQUFwRCxFQUF3RDtBQUFDQyxZQUFRLEtBQVI7QUFBZTtBQUN4RSxNQUFJRixTQUFTLENBQVQsSUFBY0MsT0FBTyxFQUF6QixFQUE2QjtBQUFDQyxZQUFRLGFBQVI7QUFBdUI7QUFDckQsTUFBSUYsU0FBUyxDQUFULElBQWNDLFFBQU8sRUFBckIsSUFBMkJELFNBQVMsQ0FBVCxJQUFjQyxRQUFPLEVBQXBELEVBQXdEO0FBQUNDLFlBQVEsS0FBUjtBQUFlO0FBQ3hFLE1BQUlGLFNBQVMsQ0FBVCxJQUFjQyxPQUFPLEVBQXpCLEVBQTZCO0FBQUNDLFlBQVEsUUFBUjtBQUFrQjtBQUNoRCxNQUFJRixTQUFTLENBQVQsSUFBY0MsUUFBTyxFQUFyQixJQUEyQkQsU0FBUyxDQUFULElBQWNDLFFBQU8sRUFBcEQsRUFBd0Q7QUFBQ0MsWUFBUSxLQUFSO0FBQWU7QUFDeEUsTUFBSUYsU0FBUyxDQUFULElBQWNDLE9BQU8sRUFBekIsRUFBNkI7QUFBQ0MsWUFBUSxZQUFSO0FBQXNCO0FBQ3BELE1BQUlGLFNBQVMsQ0FBVCxJQUFjQyxRQUFPLEVBQXJCLElBQTJCRCxTQUFTLENBQVQsSUFBY0MsUUFBTyxFQUFwRCxFQUF3RDtBQUFDQyxZQUFRLEtBQVI7QUFBZTtBQUN4RSxNQUFJRixTQUFTLENBQVQsSUFBY0MsT0FBTyxFQUF6QixFQUE2QjtBQUFDQyxZQUFRLGNBQVI7QUFBd0I7QUFDdEQsTUFBSUYsU0FBUyxDQUFULElBQWNDLFFBQU8sRUFBckIsSUFBMkJELFNBQVMsRUFBVCxJQUFlQyxRQUFPLEVBQXJELEVBQXlEO0FBQUNDLFlBQVEsS0FBUjtBQUFlO0FBQ3pFLE1BQUlGLFNBQVMsQ0FBVCxJQUFjQyxPQUFPLEVBQXpCLEVBQTZCO0FBQUNDLFlBQVEsWUFBUjtBQUFzQjtBQUNwRCxNQUFJRixTQUFTLEVBQVQsSUFBZUMsUUFBTyxFQUF0QixJQUE0QkQsU0FBUyxFQUFULElBQWVDLFFBQU8sRUFBdEQsRUFBMEQ7QUFBQ0MsWUFBUSxLQUFSO0FBQWU7QUFDMUUsTUFBSUYsU0FBUyxFQUFULElBQWVDLE9BQU8sRUFBMUIsRUFBOEI7QUFBQ0MsWUFBUSxZQUFSO0FBQXNCO0FBQ3JELE1BQUlGLFNBQVMsRUFBVCxJQUFlQyxRQUFPLEVBQXRCLElBQTRCRCxTQUFTLEVBQVQsSUFBZUMsUUFBTyxFQUF0RCxFQUEwRDtBQUFDQyxZQUFRLEtBQVI7QUFBZTtBQUMxRSxNQUFJRixTQUFTLEVBQVQsSUFBZUMsT0FBTyxFQUExQixFQUE4QjtBQUFDQyxZQUFRLGNBQVI7QUFBd0I7QUFDdkQsTUFBSUYsU0FBUyxFQUFULElBQWVDLFFBQU8sRUFBdEIsSUFBNEJELFNBQVMsQ0FBVCxJQUFjQyxRQUFPLEVBQXJELEVBQXlEO0FBQUNDLFlBQVEsS0FBUjtBQUFlO0FBQ3pFLE1BQUlGLFNBQVMsRUFBVCxJQUFlQyxPQUFPLEVBQTFCLEVBQThCO0FBQUNDLFlBQVEsU0FBUjtBQUFtQjtBQUNsRDtBQUNBLFNBQU9BLEtBQVA7QUFDRDtBQUNGLFNBQVNFLGNBQVQsR0FBMEI7QUFDeEIsTUFBSUMsT0FBTyxFQUFYO0FBQ0EsTUFBSUosT0FBTyxJQUFJUixJQUFKLEVBQVg7QUFDQSxNQUFJYSxJQUFJTCxLQUFLTSxXQUFMLEVBQVI7QUFDQSxNQUFJQyxJQUFJUCxLQUFLUSxRQUFMLEtBQWtCLENBQTFCO0FBQ0FELE1BQUlBLElBQUksRUFBSixHQUFTLE1BQU1BLENBQWYsR0FBbUJBLENBQXZCO0FBQ0EsTUFBSUUsSUFBSVQsS0FBS1UsT0FBTCxLQUFpQixFQUFqQixHQUFzQixNQUFNVixLQUFLVSxPQUFMLEVBQTVCLEdBQTZDVixLQUFLVSxPQUFMLEVBQXJEO0FBQ0EsTUFBSUMsSUFBSVgsS0FBS1ksUUFBTCxLQUFrQixFQUFsQixHQUF1QixNQUFNWixLQUFLWSxRQUFMLEVBQTdCLEdBQStDWixLQUFLWSxRQUFMLEVBQXZEO0FBQ0EsTUFBSUMsSUFBSWIsS0FBS2MsVUFBTCxLQUFvQixFQUFwQixHQUF5QixNQUFNZCxLQUFLYyxVQUFMLEVBQS9CLEdBQW1EZCxLQUFLYyxVQUFMLEVBQTNEO0FBQ0EsTUFBSUMsSUFBSWYsS0FBS2dCLFVBQUwsS0FBb0IsRUFBcEIsR0FBeUIsTUFBTWhCLEtBQUtnQixVQUFMLEVBQS9CLEdBQW1EaEIsS0FBS2dCLFVBQUwsRUFBM0Q7QUFDQSxNQUFJQyxPQUFPQyxLQUFLQyxLQUFMLENBQVdELEtBQUtFLE1BQUwsS0FBZ0IsR0FBaEIsR0FBc0IsR0FBakMsQ0FBWDtBQUNBaEIsU0FBT0MsSUFBSSxFQUFKLEdBQVNFLENBQVQsR0FBYSxFQUFiLEdBQWtCRSxDQUFsQixHQUFzQixFQUF0QixHQUEyQkUsQ0FBM0IsR0FBK0IsRUFBL0IsR0FBb0NFLENBQXBDLEdBQXdDLEVBQXhDLEdBQTZDRSxDQUFwRDtBQUNBLFNBQU9YLElBQVAsQ0Fad0IsQ0FZWDtBQUNkOztBQUVELFNBQVNpQixRQUFULENBQWtCQyxDQUFsQixFQUFxQjtBQUNuQjtBQUNBLE1BQUdBLEtBQUssQ0FBUixFQUFXO0FBQ1QsV0FBTyxDQUFQO0FBQ0QsR0FGRCxNQUVPLElBQUdBLEtBQUssRUFBUixFQUFZO0FBQ2pCLFdBQU8sQ0FBUDtBQUNELEdBRk0sTUFFQSxJQUFHQSxLQUFLLEVBQVIsRUFBWTtBQUNqQixXQUFPLENBQVA7QUFDRCxHQUZNLE1BRUEsSUFBR0EsS0FBSyxFQUFSLEVBQVk7QUFDakIsV0FBTyxDQUFQO0FBQ0QsR0FGTSxNQUVBLElBQUdBLEtBQUssRUFBUixFQUFZO0FBQ2pCLFdBQU8sQ0FBUDtBQUNELEdBRk0sTUFFQSxJQUFHQSxLQUFLLEdBQVIsRUFBYTtBQUNsQixXQUFPLENBQVA7QUFDRCxHQUZNLE1BRUEsSUFBR0EsS0FBSyxHQUFSLEVBQWE7QUFDbEIsV0FBTyxDQUFQO0FBQ0QsR0FGTSxNQUVBLElBQUdBLEtBQUssR0FBUixFQUFhO0FBQ2xCLFdBQU8sQ0FBUDtBQUNELEdBRk0sTUFFQSxJQUFHQSxLQUFLLElBQVIsRUFBYztBQUNuQixXQUFPLENBQVA7QUFDRCxHQUZNLE1BRUE7QUFDTCxXQUFPLENBQVA7QUFDRDtBQUNGOztBQUVELFNBQVNDLFFBQVQsQ0FBa0JDLENBQWxCLEVBQXFCQyxDQUFyQixFQUF3QjtBQUN0QixNQUFJQyxPQUFPRCxLQUFLLElBQWhCO0FBQ0EsTUFBSUUsTUFBTSxFQUFWO0FBQ0EsTUFBSUgsQ0FBSixFQUFPO0FBQ0wsUUFBSUksWUFBWSxJQUFJcEMsSUFBSixDQUFTZ0MsQ0FBVCxDQUFoQjtBQUNBLFFBQUlLLE1BQU0sSUFBSXJDLElBQUosRUFBVjtBQUNBLFFBQUl1QixJQUFJYyxNQUFNRCxTQUFkO0FBQ0EsUUFBSWIsSUFBSyxXQUFXLENBQXBCLEVBQXdCO0FBQ3RCLFVBQUllLE1BQU1aLEtBQUthLEtBQUwsQ0FBV2hCLElBQUksUUFBZixDQUFWO0FBQ0EsVUFBSWlCLE9BQU9kLEtBQUthLEtBQUwsQ0FBWWhCLElBQUksUUFBTCxHQUFpQixPQUE1QixDQUFYO0FBQ0EsVUFBSWtCLFNBQVNmLEtBQUthLEtBQUwsQ0FBWWhCLElBQUksUUFBSixHQUFlLE9BQWhCLEdBQTJCLEtBQXRDLENBQWI7QUFDQSxVQUFJbUIsVUFBVWhCLEtBQUthLEtBQUwsQ0FBV2hCLElBQUksUUFBSixHQUFlLE9BQWYsR0FBeUIsS0FBcEMsSUFBNkMsSUFBM0Q7QUFDQSxVQUFJZSxNQUFNLENBQVYsRUFBYTtBQUNYLFlBQUdKLElBQUgsRUFBUztBQUNQLGNBQUdJLE1BQU0sQ0FBVCxFQUFZO0FBQ1ZILGtCQUFNRyxNQUFNLFdBQVo7QUFDRCxXQUZELE1BRU87QUFDTEgsa0JBQU1HLE1BQU0sVUFBWjtBQUNEO0FBQ0YsU0FORCxNQU1PO0FBQ0pILGdCQUFNRyxNQUFNLElBQVo7QUFDRjtBQUNDLGVBQU9ILEdBQVA7QUFDSDtBQUNELFVBQUlLLE9BQU8sQ0FBWCxFQUFjO0FBQ1osWUFBR04sSUFBSCxFQUFTO0FBQ1AsY0FBR00sT0FBTyxDQUFWLEVBQWE7QUFDWEwsa0JBQU1LLE9BQU8sWUFBYjtBQUNELFdBRkQsTUFFTztBQUNMTCxrQkFBTUssT0FBTyxXQUFiO0FBQ0Q7QUFDRixTQU5ELE1BTU87QUFDTEwsZ0JBQU1LLE9BQU8sS0FBYjtBQUNEO0FBQ0MsZUFBT0wsR0FBUDtBQUNIO0FBQ0QsVUFBSU0sU0FBUyxDQUFiLEVBQWdCO0FBQ2QsWUFBR1AsSUFBSCxFQUFTO0FBQ1AsY0FBR08sU0FBUyxDQUFaLEVBQWU7QUFDYk4sa0JBQU1NLFNBQVMsY0FBZjtBQUNELFdBRkQsTUFFTztBQUNMTixrQkFBTU0sU0FBUyxhQUFmO0FBQ0Q7QUFDRixTQU5ELE1BTU87QUFDSk4sZ0JBQU1NLFNBQVMsS0FBZjtBQUNGO0FBQ0MsZUFBT04sR0FBUDtBQUNIO0FBQ0QsVUFBSU8sVUFBVSxFQUFkLEVBQWtCO0FBQ2hCLFlBQUdSLElBQUgsRUFBUztBQUNQQyxnQkFBTSxVQUFOO0FBQ0QsU0FGRCxNQUVPO0FBQ0pBLGdCQUFNLElBQU47QUFDRjs7QUFFQyxlQUFPQSxHQUFQO0FBQ0g7QUFDRCxLQWxERixNQWtEUTtBQUNGLGFBQU9ILEVBQUVXLFNBQUYsQ0FBWSxDQUFaLEVBQWUsRUFBZixDQUFQO0FBQ0w7QUFDRixHQXpERCxNQXlETztBQUNKLFdBQU9SLEdBQVA7QUFDRjtBQUNGO0FBQ0RTLE9BQU9DLE9BQVAsR0FBaUI7QUFDZmxDLGtCQUFnQkEsY0FERDtBQUVma0IsWUFBVUEsUUFGSztBQUdmRSxZQUFVQSxRQUhLO0FBSWZsQyxPQUFLQSxHQUpVO0FBS2ZTLGlCQUFlQTtBQUxBLENBQWpCIiwiZmlsZSI6InV0aWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBBdXRob3I6IE1pY2hhZWxDaGVuIDxteW1hYz5cbiAqIEBEYXRlOiAgIDIwMTgtMDEtMzBUMTA6MDI6NDIrMDg6MDBcbiAqIEBFbWFpbDogIHRlYWNoZXJpbmNhZmVAMTYzLmNvbVxuICogQFByb2plY3Q6IG9uZV9zZXJ2ZXJcbiAqIEBGaWxlbmFtZTogdXRpbC5qc1xuICogQExhc3QgbW9kaWZpZWQgYnk6ICAgbXltYWNcbiAqIEBMYXN0IG1vZGlmaWVkIHRpbWU6IDIwMTgtMDItMTFUMjA6NDA6NDIrMDg6MDBcbiAqL1xuICBmdW5jdGlvbiBhZ2UgKGJpcnRoRGF0ZSkge1xuICAgIHZhciBjdXJyZW50VGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIHZhciBjdXN0b21SZWdFeHAgPSAvKFxcZHs0fSlcXC0oXFxkezJ9KVxcLShcXGR7Mn0pL1xuICAgIHZhciBkYXRlMSA9IGN1c3RvbVJlZ0V4cC5leGVjKGN1cnJlbnRUaW1lKVxuICAgIHZhciBkYXRlMiA9IGN1c3RvbVJlZ0V4cC5leGVjKGJpcnRoRGF0ZSlcbiAgICByZXR1cm4gKGRhdGUxWzFdIC0gZGF0ZTJbMV0pIC0gKGRhdGUxWzJdIDwgZGF0ZTFbMl0gPyAxIDogMClcbiAgfVxuICBmdW5jdGlvbiBjb25zdGVsbGF0aW9uKGJpcnRoRGF0ZSkge1xuICAgIHZhciBtb250aCwgZGF0ZSwgdmFsdWVcbiAgICB2YXIgY3VzdG9tUmVnRXhwID0gLyhcXGR7NH0pXFwtKFxcZHsyfSlcXC0oXFxkezJ9KS9cbiAgICB2YXIgcmVzID0gY3VzdG9tUmVnRXhwLmV4ZWMoYmlydGhEYXRlKVxuICAgIG1vbnRoID0gcmVzWzJdXG4gICAgZGF0ZSA9IHJlc1szXVxuICAgIGlmIChtb250aCA9PSAxICYmIGRhdGUgPj0yMCB8fCBtb250aCA9PSAyICYmIGRhdGUgPD0xOCkge3ZhbHVlID0gXCLmsLTnk7bluqdcIjt9XG4gICAgaWYgKG1vbnRoID09IDEgJiYgZGF0ZSA+IDMxKSB7dmFsdWUgPSBcImh1aD9cIjt9XG4gICAgaWYgKG1vbnRoID09IDIgJiYgZGF0ZSA+PTE5IHx8IG1vbnRoID09IDMgJiYgZGF0ZSA8PTIwKSB7dmFsdWUgPSBcIuWPjOmxvOW6p1wiO31cbiAgICBpZiAobW9udGggPT0gMiAmJiBkYXRlID4gMjkpIHt2YWx1ZSA9IFwic2F5IHdoYXQ/XCI7fVxuICAgIGlmIChtb250aCA9PSAzICYmIGRhdGUgPj0yMSB8fCBtb250aCA9PSA0ICYmIGRhdGUgPD0xOSkge3ZhbHVlID0gXCLnmb3nvorluqdcIjt9XG4gICAgaWYgKG1vbnRoID09IDMgJiYgZGF0ZSA+IDMxKSB7dmFsdWUgPSBcIm9rLiB3aGF0ZXZlci5cIjt9XG4gICAgaWYgKG1vbnRoID09IDQgJiYgZGF0ZSA+PTIwIHx8IG1vbnRoID09IDUgJiYgZGF0ZSA8PTIwKSB7dmFsdWUgPSBcIumHkeeJm+W6p1wiO31cbiAgICBpZiAobW9udGggPT0gNCAmJiBkYXRlID4gMzApIHt2YWx1ZSA9IFwiaSdtIHNvb29vIHNvcnJ5IVwiO31cbiAgICBpZiAobW9udGggPT0gNSAmJiBkYXRlID49MjEgfHwgbW9udGggPT0gNiAmJiBkYXRlIDw9MjEpIHt2YWx1ZSA9IFwi5Y+M5a2Q5bqnXCI7fVxuICAgIGlmIChtb250aCA9PSA1ICYmIGRhdGUgPiAzMSkge3ZhbHVlID0gXCJ1bW0gLi4uIG5vLlwiO31cbiAgICBpZiAobW9udGggPT0gNiAmJiBkYXRlID49MjIgfHwgbW9udGggPT0gNyAmJiBkYXRlIDw9MjIpIHt2YWx1ZSA9IFwi5beo6J+55bqnXCI7fVxuICAgIGlmIChtb250aCA9PSA2ICYmIGRhdGUgPiAzMCkge3ZhbHVlID0gXCJzb3JyeS5cIjt9XG4gICAgaWYgKG1vbnRoID09IDcgJiYgZGF0ZSA+PTIzIHx8IG1vbnRoID09IDggJiYgZGF0ZSA8PTIyKSB7dmFsdWUgPSBcIueLruWtkOW6p1wiO31cbiAgICBpZiAobW9udGggPT0gNyAmJiBkYXRlID4gMzEpIHt2YWx1ZSA9IFwiZXhjdXNlIG1lP1wiO31cbiAgICBpZiAobW9udGggPT0gOCAmJiBkYXRlID49MjMgfHwgbW9udGggPT0gOSAmJiBkYXRlIDw9MjIpIHt2YWx1ZSA9IFwi5a6k5aWz5bqnXCI7fVxuICAgIGlmIChtb250aCA9PSA4ICYmIGRhdGUgPiAzMSkge3ZhbHVlID0gXCJ5ZWFoLiByaWdodC5cIjt9XG4gICAgaWYgKG1vbnRoID09IDkgJiYgZGF0ZSA+PTIzIHx8IG1vbnRoID09IDEwICYmIGRhdGUgPD0yMikge3ZhbHVlID0gXCLlpKnnp6TluqdcIjt9XG4gICAgaWYgKG1vbnRoID09IDkgJiYgZGF0ZSA+IDMwKSB7dmFsdWUgPSBcInRyeSBhZ2Fpbi5cIjt9XG4gICAgaWYgKG1vbnRoID09IDEwICYmIGRhdGUgPj0yMyB8fCBtb250aCA9PSAxMSAmJiBkYXRlIDw9MjEpIHt2YWx1ZSA9IFwi5aSp6J2O5bqnXCI7fVxuICAgIGlmIChtb250aCA9PSAxMCAmJiBkYXRlID4gMzEpIHt2YWx1ZSA9IFwiZm9yZ2V0IGl0IVwiO31cbiAgICBpZiAobW9udGggPT0gMTEgJiYgZGF0ZSA+PTIyIHx8IG1vbnRoID09IDEyICYmIGRhdGUgPD0yMSkge3ZhbHVlID0gXCLkurrpqazluqdcIjt9XG4gICAgaWYgKG1vbnRoID09IDExICYmIGRhdGUgPiAzMCkge3ZhbHVlID0gXCJpbnZhbGlkIGRhdGVcIjt9XG4gICAgaWYgKG1vbnRoID09IDEyICYmIGRhdGUgPj0yMiB8fCBtb250aCA9PSAxICYmIGRhdGUgPD0xOSkge3ZhbHVlID0gXCLmkannvq/luqdcIjt9XG4gICAgaWYgKG1vbnRoID09IDEyICYmIGRhdGUgPiAzMSkge3ZhbHVlID0gXCJubyB3YXkhXCI7fVxuICAgIC8vIGNvbnNvbGUubG9nKCfmmJ/luqcgdmFsdWU6ICcgKyB2YWx1ZSk7XG4gICAgcmV0dXJuIHZhbHVlXG4gIH1cbiBmdW5jdGlvbiBnZXRDdXJyZW50VGltZSgpIHtcbiAgIHZhciBrZWVwID0gJyc7XG4gICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICB2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgIHZhciBtID0gZGF0ZS5nZXRNb250aCgpICsgMTtcbiAgIG0gPSBtIDwgMTAgPyAnMCcgKyBtIDogbTtcbiAgIHZhciBkID0gZGF0ZS5nZXREYXRlKCkgPCAxMCA/ICcwJyArIGRhdGUuZ2V0RGF0ZSgpIDogZGF0ZS5nZXREYXRlKCk7XG4gICB2YXIgaCA9IGRhdGUuZ2V0SG91cnMoKSA8IDEwID8gJzAnICsgZGF0ZS5nZXRIb3VycygpIDogZGF0ZS5nZXRIb3VycygpO1xuICAgdmFyIGYgPSBkYXRlLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnICsgZGF0ZS5nZXRNaW51dGVzKCkgOiBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgIHZhciBzID0gZGF0ZS5nZXRTZWNvbmRzKCkgPCAxMCA/ICcwJyArIGRhdGUuZ2V0U2Vjb25kcygpIDogZGF0ZS5nZXRTZWNvbmRzKCk7XG4gICB2YXIgcmFuZCA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDg5OSArIDEwMCk7XG4gICBrZWVwID0geSArICcnICsgbSArICcnICsgZCArICcnICsgaCArICcnICsgZiArICcnICsgcztcbiAgIHJldHVybiBrZWVwOyAvLzIwMTYwNjE0MTM0OTQ3XG4gfVxuXG4gZnVuY3Rpb24gY2FsTGV2ZWwocCkge1xuICAgLy9wb2ludHMgLT4gbGV2ZWwgbWVjaGFuaXNtXG4gICBpZihwIDw9IDIpIHtcbiAgICAgcmV0dXJuIDFcbiAgIH0gZWxzZSBpZihwIDw9IDEwKSB7XG4gICAgIHJldHVybiAyXG4gICB9IGVsc2UgaWYocCA8PSAyMCkge1xuICAgICByZXR1cm4gM1xuICAgfSBlbHNlIGlmKHAgPD0gNDApIHtcbiAgICAgcmV0dXJuIDRcbiAgIH0gZWxzZSBpZihwIDw9IDgwKSB7XG4gICAgIHJldHVybiA1XG4gICB9IGVsc2UgaWYocCA8PSAxNjApIHtcbiAgICAgcmV0dXJuIDZcbiAgIH0gZWxzZSBpZihwIDw9IDMyMCkge1xuICAgICByZXR1cm4gN1xuICAgfSBlbHNlIGlmKHAgPD0gNjQwKSB7XG4gICAgIHJldHVybiA4XG4gICB9IGVsc2UgaWYocCA8PSAxMjgwKSB7XG4gICAgIHJldHVybiA5XG4gICB9IGVsc2Uge1xuICAgICByZXR1cm4gMVxuICAgfVxuIH1cblxuIGZ1bmN0aW9uIGNhbGNUaW1lKHQsIGwpIHtcbiAgIHZhciBsYW5nID0gbCA9PSAnRU4nXG4gICB2YXIgc3RyID0gJyc7XG4gICBpZiAodCkge1xuICAgICB2YXIgY3JlYXRlZEF0ID0gbmV3IERhdGUodClcbiAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKClcbiAgICAgdmFyIHMgPSBub3cgLSBjcmVhdGVkQXRcbiAgICAgaWYgKHMgPCAoODY0MDAwMDAgKiA3KSkge1xuICAgICAgIHZhciBkYXkgPSBNYXRoLmZsb29yKHMgLyA4NjQwMDAwMCk7XG4gICAgICAgdmFyIGhvdXIgPSBNYXRoLmZsb29yKChzICUgODY0MDAwMDApIC8gMzYwMDAwMCk7XG4gICAgICAgdmFyIG1pbnV0ZSA9IE1hdGguZmxvb3IoKHMgJSA4NjQwMDAwMCAlIDM2MDAwMDApIC8gNjAwMDApO1xuICAgICAgIHZhciBzZWNvbmRzID0gTWF0aC5mbG9vcihzICUgODY0MDAwMDAgJSAzNjAwMDAwICUgNjAwMDApIC8gMTAwMDtcbiAgICAgICBpZiAoZGF5ID4gMCkge1xuICAgICAgICAgaWYobGFuZykge1xuICAgICAgICAgICBpZihkYXkgPiAxKSB7XG4gICAgICAgICAgICAgc3RyID0gZGF5ICsgJyBkYXlzIGFnbydcbiAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICBzdHIgPSBkYXkgKyAnIGRheSBhZ28nXG4gICAgICAgICAgIH1cbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdHIgPSBkYXkgKyBcIuWkqeWJjVwiO1xuICAgICAgICAgfVxuICAgICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgIH1cbiAgICAgICBpZiAoaG91ciA+IDApIHtcbiAgICAgICAgIGlmKGxhbmcpIHtcbiAgICAgICAgICAgaWYoaG91ciA+IDEpIHtcbiAgICAgICAgICAgICBzdHIgPSBob3VyICsgJyBob3VycyBhZ28nXG4gICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgc3RyID0gaG91ciArICcgaG91ciBhZ28nXG4gICAgICAgICAgIH1cbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgIHN0ciA9IGhvdXIgKyBcIuWwj+aXtuWJjVwiO1xuICAgICAgICAgfVxuICAgICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgIH1cbiAgICAgICBpZiAobWludXRlID4gMCkge1xuICAgICAgICAgaWYobGFuZykge1xuICAgICAgICAgICBpZihtaW51dGUgPiAxKSB7XG4gICAgICAgICAgICAgc3RyID0gbWludXRlICsgJyBtaW51dGVzIGFnbydcbiAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICBzdHIgPSBtaW51dGUgKyAnIG1pbnV0ZSBhZ28nXG4gICAgICAgICAgIH1cbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdHIgPSBtaW51dGUgKyBcIuWIhumSn+WJjVwiO1xuICAgICAgICAgfVxuICAgICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgIH1cbiAgICAgICBpZiAoc2Vjb25kcyA8IDYwKSB7XG4gICAgICAgICBpZihsYW5nKSB7XG4gICAgICAgICAgIHN0ciA9IFwianVzdCBub3dcIjtcbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdHIgPSBcIuWImuWImlwiO1xuICAgICAgICAgfVxuXG4gICAgICAgICAgIHJldHVybiBzdHI7XG4gICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgcmV0dXJuIHQuc3Vic3RyaW5nKDAsIDE2KTtcbiAgICAgfVxuICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBzdHI7XG4gICB9XG4gfVxuIG1vZHVsZS5leHBvcnRzID0ge1xuICAgZ2V0Q3VycmVudFRpbWU6IGdldEN1cnJlbnRUaW1lLFxuICAgY2FsTGV2ZWw6IGNhbExldmVsLFxuICAgY2FsY1RpbWU6IGNhbGNUaW1lLFxuICAgYWdlOiBhZ2UsXG4gICBjb25zdGVsbGF0aW9uOiBjb25zdGVsbGF0aW9uXG4gfVxuIl19