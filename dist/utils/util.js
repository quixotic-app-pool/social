'use strict';

/**
 * @Author: MichaelChen <mymac>
 * @Date:   2018-01-30T10:02:42+08:00
 * @Email:  teacherincafe@163.com
 * @Project: one_server
 * @Filename: util.js
 * @Last modified by:   mymac
 * @Last modified time: 2018-02-09T14:05:15+08:00
 */
function getCurrentTime() {
  var keep = '';
  var date = new Date();
  var y = date.getFullYear();
  var m = date.getMonth() + 1;
  m = m < 10 ? '0' + m : m;
  var d = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();
  var h = date.getHours() < 10 ? '0' + date.getHours() : date.getHours();
  var f = date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes();
  var s = date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds();
  var rand = Math.round(Math.random() * 899 + 100);
  keep = y + '' + m + '' + d + '' + h + '' + f + '' + s;
  return keep; //20160614134947
}

function calLevel(p) {
  //points -> level mechanism
  if (p <= 2) {
    return 1;
  } else if (p <= 10) {
    return 2;
  } else if (p <= 20) {
    return 3;
  } else if (p <= 40) {
    return 4;
  } else if (p <= 80) {
    return 5;
  } else if (p <= 160) {
    return 6;
  } else if (p <= 320) {
    return 7;
  } else if (p <= 640) {
    return 8;
  } else if (p <= 1280) {
    return 9;
  } else {
    return 1;
  }
}

function calcTime(t, l) {
  var lang = l == 'EN';
  var str = '';
  if (t) {
    var createdAt = new Date(t);
    var now = new Date();
    var s = now - createdAt;
    if (s < 86400000 * 7) {
      var day = Math.floor(s / 86400000);
      var hour = Math.floor(s % 86400000 / 3600000);
      var minute = Math.floor(s % 86400000 % 3600000 / 60000);
      var seconds = Math.floor(s % 86400000 % 3600000 % 60000) / 1000;
      if (day > 0) {
        if (lang) {
          if (day > 1) {
            str = day + ' days ago';
          } else {
            str = day + ' day ago';
          }
        } else {
          str = day + "天前";
        }
        return str;
      }
      if (hour > 0) {
        if (lang) {
          if (hour > 1) {
            str = hour + ' hours ago';
          } else {
            str = hour + ' hour ago';
          }
        } else {
          str = hour + "小时前";
        }
        return str;
      }
      if (minute > 0) {
        if (lang) {
          if (minute > 1) {
            str = minute + ' minutes ago';
          } else {
            str = minute + ' minute ago';
          }
        } else {
          str = minute + "分钟前";
        }
        return str;
      }
      if (seconds < 60) {
        if (lang) {
          str = "just now";
        } else {
          str = "刚刚";
        }

        return str;
      }
    } else {
      return t.substring(0, 16);
    }
  } else {
    return str;
  }
}
module.exports = {
  getCurrentTime: getCurrentTime,
  calLevel: calLevel,
  calcTime: calcTime
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwuanMiXSwibmFtZXMiOlsiZ2V0Q3VycmVudFRpbWUiLCJrZWVwIiwiZGF0ZSIsIkRhdGUiLCJ5IiwiZ2V0RnVsbFllYXIiLCJtIiwiZ2V0TW9udGgiLCJkIiwiZ2V0RGF0ZSIsImgiLCJnZXRIb3VycyIsImYiLCJnZXRNaW51dGVzIiwicyIsImdldFNlY29uZHMiLCJyYW5kIiwiTWF0aCIsInJvdW5kIiwicmFuZG9tIiwiY2FsTGV2ZWwiLCJwIiwiY2FsY1RpbWUiLCJ0IiwibCIsImxhbmciLCJzdHIiLCJjcmVhdGVkQXQiLCJub3ciLCJkYXkiLCJmbG9vciIsImhvdXIiLCJtaW51dGUiLCJzZWNvbmRzIiwic3Vic3RyaW5nIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7Ozs7O0FBU0MsU0FBU0EsY0FBVCxHQUEwQjtBQUN4QixNQUFJQyxPQUFPLEVBQVg7QUFDQSxNQUFJQyxPQUFPLElBQUlDLElBQUosRUFBWDtBQUNBLE1BQUlDLElBQUlGLEtBQUtHLFdBQUwsRUFBUjtBQUNBLE1BQUlDLElBQUlKLEtBQUtLLFFBQUwsS0FBa0IsQ0FBMUI7QUFDQUQsTUFBSUEsSUFBSSxFQUFKLEdBQVMsTUFBTUEsQ0FBZixHQUFtQkEsQ0FBdkI7QUFDQSxNQUFJRSxJQUFJTixLQUFLTyxPQUFMLEtBQWlCLEVBQWpCLEdBQXNCLE1BQU1QLEtBQUtPLE9BQUwsRUFBNUIsR0FBNkNQLEtBQUtPLE9BQUwsRUFBckQ7QUFDQSxNQUFJQyxJQUFJUixLQUFLUyxRQUFMLEtBQWtCLEVBQWxCLEdBQXVCLE1BQU1ULEtBQUtTLFFBQUwsRUFBN0IsR0FBK0NULEtBQUtTLFFBQUwsRUFBdkQ7QUFDQSxNQUFJQyxJQUFJVixLQUFLVyxVQUFMLEtBQW9CLEVBQXBCLEdBQXlCLE1BQU1YLEtBQUtXLFVBQUwsRUFBL0IsR0FBbURYLEtBQUtXLFVBQUwsRUFBM0Q7QUFDQSxNQUFJQyxJQUFJWixLQUFLYSxVQUFMLEtBQW9CLEVBQXBCLEdBQXlCLE1B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LEVBQVM7QUFDUCxjQUFHTyxTQUFTLENBQVosRUFBZTtBQUNiTixrQkFBTU0sU0FBUyxjQUFmO0FBQ0QsV0FGRCxNQUVPO0FBQ0xOLGtCQUFNTSxTQUFTLGFBQWY7QUFDRDtBQUNGLFNBTkQsTUFNTztBQUNKTixnQkFBTU0sU0FBUyxLQUFmO0FBQ0Y7QUFDQyxlQUFPTixHQUFQO0FBQ0g7QUFDRCxVQUFJTyxVQUFVLEVBQWQsRUFBa0I7QUFDaEIsWUFBR1IsSUFBSCxFQUFTO0FBQ1BDLGdCQUFNLFVBQU47QUFDRCxTQUZELE1BRU87QUFDSkEsZ0JBQU0sSUFBTjtBQUNGOztBQUVDLGVBQU9BLEdBQVA7QUFDSDtBQUNELEtBbERGLE1Ba0RRO0FBQ0YsYUFBT0gsRUFBRVcsU0FBRixDQUFZLENBQVosRUFBZSxFQUFmLENBQVA7QUFDTDtBQUNGLEdBekRELE1BeURPO0FBQ0osV0FBT1IsR0FBUDtBQUNGO0FBQ0Y7QUFDRFMsT0FBT0MsT0FBUCxHQUFpQjtBQUNmcEMsa0JBQWdCQSxjQUREO0FBRWZvQixZQUFVQSxRQUZLO0FBR2ZFLFlBQVVBO0FBSEssQ0FBakIiLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQEF1dGhvcjogTWljaGFlbENoZW4gPG15bWFjPlxuICogQERhdGU6ICAgMjAxOC0wMS0zMFQxMDowMjo0MiswODowMFxuICogQEVtYWlsOiAgdGVhY2hlcmluY2FmZUAxNjMuY29tXG4gKiBAUHJvamVjdDogb25lX3NlcnZlclxuICogQEZpbGVuYW1lOiB1dGlsLmpzXG4gKiBATGFzdCBtb2RpZmllZCBieTogICBteW1hY1xuICogQExhc3QgbW9kaWZpZWQgdGltZTogMjAxOC0wMi0wOVQxNDowNToxNSswODowMFxuICovXG4gZnVuY3Rpb24gZ2V0Q3VycmVudFRpbWUoKSB7XG4gICB2YXIga2VlcCA9ICcnO1xuICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgdmFyIHkgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICB2YXIgbSA9IGRhdGUuZ2V0TW9udGgoKSArIDE7XG4gICBtID0gbSA8IDEwID8gJzAnICsgbSA6IG07XG4gICB2YXIgZCA9IGRhdGUuZ2V0RGF0ZSgpIDwgMTAgPyAnMCcgKyBkYXRlLmdldERhdGUoKSA6IGRhdGUuZ2V0RGF0ZSgpO1xuICAgdmFyIGggPSBkYXRlLmdldEhvdXJzKCkgPCAxMCA/ICcwJyArIGRhdGUuZ2V0SG91cnMoKSA6IGRhdGUuZ2V0SG91cnMoKTtcbiAgIHZhciBmID0gZGF0ZS5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyArIGRhdGUuZ2V0TWludXRlcygpIDogZGF0ZS5nZXRNaW51dGVzKCk7XG4gICB2YXIgcyA9IGRhdGUuZ2V0U2Vjb25kcygpIDwgMTAgPyAnMCcgKyBkYXRlLmdldFNlY29uZHMoKSA6IGRhdGUuZ2V0U2Vjb25kcygpO1xuICAgdmFyIHJhbmQgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiA4OTkgKyAxMDApO1xuICAga2VlcCA9IHkgKyAnJyArIG0gKyAnJyArIGQgKyAnJyArIGggKyAnJyArIGYgKyAnJyArIHM7XG4gICByZXR1cm4ga2VlcDsgLy8yMDE2MDYxNDEzNDk0N1xuIH1cblxuIGZ1bmN0aW9uIGNhbExldmVsKHApIHtcbiAgIC8vcG9pbnRzIC0+IGxldmVsIG1lY2hhbmlzbVxuICAgaWYocCA8PSAyKSB7XG4gICAgIHJldHVybiAxXG4gICB9IGVsc2UgaWYocCA8PSAxMCkge1xuICAgICByZXR1cm4gMlxuICAgfSBlbHNlIGlmKHAgPD0gMjApIHtcbiAgICAgcmV0dXJuIDNcbiAgIH0gZWxzZSBpZihwIDw9IDQwKSB7XG4gICAgIHJldHVybiA0XG4gICB9IGVsc2UgaWYocCA8PSA4MCkge1xuICAgICByZXR1cm4gNVxuICAgfSBlbHNlIGlmKHAgPD0gMTYwKSB7XG4gICAgIHJldHVybiA2XG4gICB9IGVsc2UgaWYocCA8PSAzMjApIHtcbiAgICAgcmV0dXJuIDdcbiAgIH0gZWxzZSBpZihwIDw9IDY0MCkge1xuICAgICByZXR1cm4gOFxuICAgfSBlbHNlIGlmKHAgPD0gMTI4MCkge1xuICAgICByZXR1cm4gOVxuICAgfSBlbHNlIHtcbiAgICAgcmV0dXJuIDFcbiAgIH1cbiB9XG5cbiBmdW5jdGlvbiBjYWxjVGltZSh0LCBsKSB7XG4gICB2YXIgbGFuZyA9IGwgPT0gJ0VOJ1xuICAgdmFyIHN0ciA9ICcnO1xuICAgaWYgKHQpIHtcbiAgICAgdmFyIGNyZWF0ZWRBdCA9IG5ldyBEYXRlKHQpXG4gICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpXG4gICAgIHZhciBzID0gbm93IC0gY3JlYXRlZEF0XG4gICAgIGlmIChzIDwgKDg2NDAwMDAwICogNykpIHtcbiAgICAgICB2YXIgZGF5ID0gTWF0aC5mbG9vcihzIC8gODY0MDAwMDApO1xuICAgICAgIHZhciBob3VyID0gTWF0aC5mbG9vcigocyAlIDg2NDAwMDAwKSAvIDM2MDAwMDApO1xuICAgICAgIHZhciBtaW51dGUgPSBNYXRoLmZsb29yKChzICUgODY0MDAwMDAgJSAzNjAwMDAwKSAvIDYwMDAwKTtcbiAgICAgICB2YXIgc2Vjb25kcyA9IE1hdGguZmxvb3IocyAlIDg2NDAwMDAwICUgMzYwMDAwMCAlIDYwMDAwKSAvIDEwMDA7XG4gICAgICAgaWYgKGRheSA+IDApIHtcbiAgICAgICAgIGlmKGxhbmcpIHtcbiAgICAgICAgICAgaWYoZGF5ID4gMSkge1xuICAgICAgICAgICAgIHN0ciA9IGRheSArICcgZGF5cyBhZ28nXG4gICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgc3RyID0gZGF5ICsgJyBkYXkgYWdvJ1xuICAgICAgICAgICB9XG4gICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RyID0gZGF5ICsgXCLlpKnliY1cIjtcbiAgICAgICAgIH1cbiAgICAgICAgICAgcmV0dXJuIHN0cjtcbiAgICAgICB9XG4gICAgICAgaWYgKGhvdXIgPiAwKSB7XG4gICAgICAgICBpZihsYW5nKSB7XG4gICAgICAgICAgIGlmKGhvdXIgPiAxKSB7XG4gICAgICAgICAgICAgc3RyID0gaG91ciArICcgaG91cnMgYWdvJ1xuICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgIHN0ciA9IGhvdXIgKyAnIGhvdXIgYWdvJ1xuICAgICAgICAgICB9XG4gICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICBzdHIgPSBob3VyICsgXCLlsI/ml7bliY1cIjtcbiAgICAgICAgIH1cbiAgICAgICAgICAgcmV0dXJuIHN0cjtcbiAgICAgICB9XG4gICAgICAgaWYgKG1pbnV0ZSA+IDApIHtcbiAgICAgICAgIGlmKGxhbmcpIHtcbiAgICAgICAgICAgaWYobWludXRlID4gMSkge1xuICAgICAgICAgICAgIHN0ciA9IG1pbnV0ZSArICcgbWludXRlcyBhZ28nXG4gICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgc3RyID0gbWludXRlICsgJyBtaW51dGUgYWdvJ1xuICAgICAgICAgICB9XG4gICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RyID0gbWludXRlICsgXCLliIbpkp/liY1cIjtcbiAgICAgICAgIH1cbiAgICAgICAgICAgcmV0dXJuIHN0cjtcbiAgICAgICB9XG4gICAgICAgaWYgKHNlY29uZHMgPCA2MCkge1xuICAgICAgICAgaWYobGFuZykge1xuICAgICAgICAgICBzdHIgPSBcImp1c3Qgbm93XCI7XG4gICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RyID0gXCLliJrliJpcIjtcbiAgICAgICAgIH1cblxuICAgICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgIHJldHVybiB0LnN1YnN0cmluZygwLCAxNik7XG4gICAgIH1cbiAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gc3RyO1xuICAgfVxuIH1cbiBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgIGdldEN1cnJlbnRUaW1lOiBnZXRDdXJyZW50VGltZSxcbiAgIGNhbExldmVsOiBjYWxMZXZlbCxcbiAgIGNhbGNUaW1lOiBjYWxjVGltZVxuIH1cbiJdfQ==